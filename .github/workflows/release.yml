name: Release

on:
  release:
    types: [published]

permissions:
  contents: write  # Required to upload release assets

jobs:
  release:
    name: Prepare release
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Create integration zip
        run: |
          cd custom_components/meraki_dashboard
          zip -r ../../meraki_dashboard.zip . -x "*.pyc" "*/__pycache__/*" "*.git*"
      
      - name: Upload integration zip to release
        uses: softprops/action-gh-release@v2
        with:
          files: meraki_dashboard.zip
          name: "Meraki Dashboard HA Integration ${{ github.ref_name }}"
          body: |
            ## Installation
            
            ### HACS (Recommended)
            1. Add this repository as a custom repository in HACS
            2. Install "Meraki Dashboard" integration
            3. Restart Home Assistant
            
            ### Manual Installation
            1. Download `meraki_dashboard.zip`
            2. Extract to `custom_components/meraki_dashboard/` in your Home Assistant config directory
            3. Restart Home Assistant
            
            ## Changes
            See [CHANGELOG.md](https://github.com/${{ github.repository }}/blob/${{ github.ref_name }}/CHANGELOG.md) for details.
          draft: false
          prerelease: ${{ contains(github.ref_name, 'beta') || contains(github.ref_name, 'alpha') || contains(github.ref_name, 'rc') }} 